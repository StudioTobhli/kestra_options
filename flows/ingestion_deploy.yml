id: ingestion_deploy
namespace: company.team

tasks:
  - id: git_namespace_sync
    type: io.kestra.plugin.git.SyncNamespaceFiles
    namespace: company.team
    gitDirectory: scripts_for_flow
    url: "{{ secret('GIT_REPO_URL') }}"
    username: "{{ secret('GIT_USERNAME') }}"
    password: "{{ secret('GIT_TOKEN') }}"
    branch: main
    
  - id: put_data_ingest
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python put_data_ingest.py

  - id: holdings_ingest
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python holdings_ingest.py

  - id: call_data_ingest
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python call_data_ingest.py

  - id: stock_dim_ingest
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python stock_dim_ingest.py

  - id: stock_hist_ingest
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python stock_hist.py

  - id: put_leads
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python put_leads.py

  - id: put_to_sheets
    type: io.kestra.plugin.scripts.python.Commands
    namespaceFiles:
      enabled: true
    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      image: options_python_img:latest
      networkMode: "kestra_options_default"
    containerImage: ghcr.io/kestra-io/pydata:latest
    commands:
      - python write_to_sheets.py
